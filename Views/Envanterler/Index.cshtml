@model IEnumerable<StudentApp.Models.Envanterler>

@{
    ViewData["Title"] = "Envanter Y�netimi";
    var toplamDeger = ViewBag.ToplamDeger as decimal? ?? 0;
    var toplamKalem = ViewBag.ToplamKalem as int? ?? 0;
    var toplamAdet = ViewBag.ToplamAdet as int? ?? 0;
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-boxes me-2"></i>Envanter Y�netimi</h2>
    <a asp-action="Create" class="btn btn-success">
    <i class="fas fa-plus me-1"></i>Yeni Envanter Ekle
    </a>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
 <i class="fas fa-check-circle me-2"></i>@TempData["SuccessMessage"]
   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i>@TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<!-- Arama ve Filtre -->
<div class="card mb-4">
<div class="card-body">
        <form asp-action="Index" method="get" class="row g-3 align-items-end">
       <div class="col-md-8">
       <label for="searchTerm" class="form-label">
              <i class="fas fa-search me-1"></i>Envanter Ara
    </label>
        <input type="text" name="searchTerm" id="searchTerm" class="form-control" 
placeholder="Envanter ad�, a��klama veya fiyat aral���..." 
     value="@ViewBag.SearchTerm" />
  </div>
       <div class="col-md-2">
    <label for="stokDurumu" class="form-label">
  <i class="fas fa-filter me-1"></i>Stok Durumu
                </label>
      <select name="stokDurumu" id="stokDurumu" class="form-select">
       <option value="">T�m�</option>
          <option value="stokta" selected="@(ViewBag.StokDurumu == "stokta" ? "selected" : null)">Stokta Var</option>
      <option value="tukendi" selected="@(ViewBag.StokDurumu == "tukendi" ? "selected" : null)">T�kendi</option>
      <option value="azaldi" selected="@(ViewBag.StokDurumu == "azaldi" ? "selected" : null)">Stok Azald� (?5)</option>
  </select>
            </div>
    <div class="col-md-2 d-flex gap-2">
          <button type="submit" class="btn btn-primary flex-grow-1">
      <i class="fas fa-search me-1"></i>Ara
              </button>
      @if (!string.IsNullOrEmpty(ViewBag.SearchTerm as string) || !string.IsNullOrEmpty(ViewBag.StokDurumu as string))
        {
              <a asp-action="Index" class="btn btn-outline-secondary" title="Filtreyi Temizle">
            <i class="fas fa-times"></i>
         </a>
          }
    </div>
        </form>
    </div>
</div>

<!-- �statistik Kartlar� -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card bg-primary text-white">
            <div class="card-body">
         <h5 class="card-title">
         <i class="fas fa-list me-2"></i>Toplam Kalem
      </h5>
          <h3 class="mb-0">@toplamKalem</h3>
                <small>Farkl� envanter kalemi</small>
         </div>
        </div>
    </div>
 <div class="col-md-4">
      <div class="card bg-info text-white">
   <div class="card-body">
     <h5 class="card-title">
   <i class="fas fa-cubes me-2"></i>Toplam Adet
              </h5>
        <h3 class="mb-0">@toplamAdet</h3>
   <small>Toplam �r�n adedi</small>
     </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-success text-white">
        <div class="card-body">
    <h5 class="card-title">
       <span style="font-family: Arial, sans-serif;">&#8378;</span> Toplam Al�� De�er
   </h5>
       <h3 class="mb-0"><span style="font-family: Arial, sans-serif;">&#8378;</span> @toplamDeger.ToString("N2")</h3>
   <small>Envanter toplam al�� de�eri</small>
     </div>
     </div>
    </div>
</div>

@if (Model.Any())
{
    <div class="card">
        <div class="card-body">
 <div class="table-responsive">
     <table class="table table-striped table-hover" id="envanterTable">
          <thead>
      <tr>
       <th>
          <i class="fas fa-box me-1"></i>Envanter Ad�
         </th>
    <th class="text-center">
   <i class="fas fa-sort-numeric-up me-1"></i>Adet
       </th>
       <th class="text-end">
      <i class="fas fa-shopping-cart me-1"></i>Al�� Fiyat�
   </th>
  <th class="text-end">
    <i class="fas fa-tag me-1"></i>Sat�� Fiyat�
     </th>
     <th class="text-end">
    <i class="fas fa-calculator me-1"></i>Toplam Al�� De�eri
  </th>
       <th class="text-center">
    <i class="fas fa-toggle-on me-1"></i>Durum
</th>
      <th>
    <i class="fas fa-comment me-1"></i>A��klama
    </th>
       <th class="text-center">��lemler</th>
  </tr>
            </thead>
        <tbody>
        @foreach (var item in Model)
     {
 var toplamDegerItem = item.Adet * item.AlisFiyat;
      <tr>
    <td>
     <strong>@item.EnvanterAdi</strong>
        </td>
       <td class="text-center">
     <span class="badge bg-info fs-6">@item.Adet</span>
 </td>
    <td class="text-end">
    <span style="font-family: Arial, sans-serif;">&#8378;@item.AlisFiyat.ToString("N2")</span>
     </td>
       <td class="text-end">
  <span style="font-family: Arial, sans-serif;">&#8378;@item.SatisFiyat.ToString("N2")</span>
  </td>
      <td class="text-end">
     <strong style="font-family: Arial, sans-serif;">&#8378;@toplamDegerItem.ToString("N2")</strong>
     </td>
   <td class="text-center">
   @if (item.Aktif)
      {
       <span class="badge bg-success">
        <i class="fas fa-check-circle me-1"></i>Aktif
    </span>
    }
 else
      {
   <span class="badge bg-secondary">
   <i class="fas fa-times-circle me-1"></i>Pasif
  </span>
       }
      </td>
      <td>
   @if (!string.IsNullOrWhiteSpace(item.Aciklama))
          {
    <small>@item.Aciklama</small>
     }
   else
       {
   <span class="text-muted">-</span>
   }
  </td>
     <td class="text-center">
      <div class="btn-group" role="group">
       <a asp-action="Details" asp-route-id="@item.Id"
    class="btn btn-sm btn-outline-info" title="Detaylar� G�r�nt�le">
   <i class="fas fa-eye"></i>
   </a>
         <a asp-action="Edit" asp-route-id="@item.Id"
        class="btn btn-sm btn-outline-warning" title="D�zenle">
  <i class="fas fa-edit"></i>
 </a>
      <a asp-action="Delete" asp-route-id="@item.Id"
         class="btn btn-sm btn-outline-danger" title="Sil">
  <i class="fas fa-trash"></i>
      </a>
    </div>
      </td>
 </tr>
      }
 </tbody>
     </table>
            </div>
        </div>
    </div>
}
else
{
    <div class="alert alert-info" role="alert">
        <i class="fas fa-info-circle me-2"></i>
        Hen�z envanter kayd� bulunmamaktad�r. Yeni envanter eklemek i�in yukar�daki butonu kullanabilirsiniz.
    </div>
}

@section Scripts {
    <script>
    // DataTable initialization
     $(document).ready(function() {
            $('#envanterTable').DataTable({
    language: {
  url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/tr.json'
           },
order: [[0, 'asc']],
           pageLength: 25,
           responsive: true
            });
        });
 </script>
}
