@model IEnumerable<StudentApp.Models.OgrenciOdemeTakvimi>

@{
    ViewData["Title"] = "Ödeme Takvimleri";
    var ogrenciAdi = ViewBag.OgrenciAdi as string;
    var ogrenciId = ViewBag.OgrenciId as long?;
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2><i class="fas fa-money-check-alt me-2"></i>Ödeme Takvimleri</h2>
     @if (!string.IsNullOrEmpty(ogrenciAdi))
  {
     <p class="text-muted mb-0">
        <i class="fas fa-user me-1"></i>@ogrenciAdi
       </p>
        }
    </div>
    <div>
        @if (ogrenciId.HasValue)
        {
   <a asp-controller="Ogrenciler" asp-action="Index" class="btn btn-secondary me-2">
      <i class="fas fa-arrow-left me-1"></i>Öðrencilere Dön
    </a>
  <a asp-action="Create" asp-route-ogrenciId="@ogrenciId" class="btn btn-success">
   <i class="fas fa-plus me-1"></i>Yeni Ödeme Gir
            </a>
        }
 else
  {
      <a asp-action="Create" class="btn btn-success">
     <i class="fas fa-plus me-1"></i>Yeni Ödeme Gir
    </a>
        }
    </div>
</div>

@if (Model.Any())
{
    var toplamOdenen = Model.Sum(o => o.OdenenTutar);
    var sonBorc = ogrenciId.HasValue 
        ? Model.OrderByDescending(o => o.OdemeTarihi).FirstOrDefault()?.BorcTutari ?? 0
        : (ViewBag.ToplamKalanBorc as decimal? ?? 0);

    <div class="row mb-4">
        <div class="col-md-6">
     <div class="card bg-success text-white">
      <div class="card-body">
                    <h5 class="card-title">
 <i class="fas fa-check-circle me-2"></i>Toplam Ödenen
          </h5>
  <h3 class="mb-0"><span style="font-family: Arial, sans-serif;">&#8378;</span> @toplamOdenen.ToString("N2")</h3>
 @if (!ogrenciId.HasValue)
             {
      <small>Tüm öðrenciler</small>
         }
     </div>
     </div>
  </div>
        <div class="col-md-6">
     <div class="card bg-danger text-white">
       <div class="card-body">
          <h5 class="card-title">
       <i class="fas fa-exclamation-circle me-2"></i>
               @if (ogrenciId.HasValue)
    {
       <span>Kalan Borç</span>
    }
   else
  {
      <span>Toplam Kalan Borç</span>
             }
           </h5>
       <h3 class="mb-0"><span style="font-family: Arial, sans-serif;">&#8378;</span> @sonBorc.ToString("N2")</h3>
            @if (!ogrenciId.HasValue)
     {
      <small>Tüm aktif öðrenciler</small>
          }
    </div>
    </div>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
       <thead>
                <tr>
              @if (!ogrenciId.HasValue)
         {
     <th>Öðrenci</th>
   }
       <th>Ödeme Tarihi</th>
  <th>Ödenen Tutar</th>
  <th>Kalan Borç</th>
             <th>Açýklama</th>
              <th class="text-center">Ýþlemler</th>
                </tr>
    </thead>
<tbody>
      @foreach (var item in Model)
        {
    <tr>
      @if (!ogrenciId.HasValue && item.Ogrenci != null)
    {
        <td>
  <i class="fas fa-user me-1"></i>
           @item.Ogrenci.OgrenciAdi @item.Ogrenci.OgrenciSoyadi
        </td>
      }
            <td>
       @if (item.OdemeTarihi.HasValue)
     {
                <i class="fas fa-calendar me-1"></i>@item.OdemeTarihi.Value.ToString("dd.MM.yyyy")
           }
else
     {
     <span class="text-muted">-</span>
       }
      </td>
             <td>
       <span class="badge bg-success fs-6" style="font-family: Arial, sans-serif;">
               &#8378; @item.OdenenTutar.ToString("N2")
     </span>
     </td>
 <td>
    <span class="badge bg-warning text-dark fs-6" style="font-family: Arial, sans-serif;">
       &#8378; @item.BorcTutari.ToString("N2")
          </span>
   </td>
      <td>
         @if (!string.IsNullOrWhiteSpace(item.Aciklama))
    {
                 <small>@item.Aciklama</small>
         }
            else
         {
           <span class="text-muted">-</span>
      }
        </td>
               <td class="text-center">
          <div class="btn-group" role="group">
      <a asp-action="Details" asp-route-id="@item.Id" 
 class="btn btn-sm btn-outline-info" title="Detaylarý Görüntüle">
      <i class="fas fa-eye"></i>
          </a>
          <a asp-action="Edit" asp-route-id="@item.Id" 
    class="btn btn-sm btn-outline-warning" title="Düzenle">
    <i class="fas fa-edit"></i>
 </a>
        <a asp-action="Delete" asp-route-id="@item.Id" 
         class="btn btn-sm btn-outline-danger" title="Sil">
           <i class="fas fa-trash"></i>
      </a>
       </div>
      </td>
          </tr>
          }
     </tbody>
        </table>
    </div>
}
else
{
    <div class="text-center py-5">
 <i class="fas fa-lira-sign fa-3x text-muted mb-3"></i>
 <h4 class="text-muted">Ödeme kaydý bulunamadý</h4>
     <p class="text-muted">
    @if (!string.IsNullOrEmpty(ogrenciAdi))
 {
       <span>Bu öðrenci için henüz ödeme kaydý bulunmuyor.</span>
      }
  else
            {
 <span>Henüz hiçbir ödeme kaydý bulunmuyor.</span>
            }
        </p>
        @if (ogrenciId.HasValue)
    {
            <a asp-action="Create" asp-route-ogrenciId="@ogrenciId" class="btn btn-success">
            <i class="fas fa-plus me-1"></i>Ýlk Ödemeyi Gir
    </a>
    }
    else
        {
<a asp-action="Create" class="btn btn-success">
          <i class="fas fa-plus me-1"></i>Ýlk Ödemeyi Gir
     </a>
        }
    </div>
}
